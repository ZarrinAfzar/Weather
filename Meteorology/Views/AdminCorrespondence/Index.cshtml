@using Weather.Data.Base
@using Microsoft.AspNetCore.Identity

@model Weather.Data.ViewModel.CorrespondenceViewModel
@inject UserManager<User> UserManager
@{
    var user = await UserManager.GetUserAsync(User);
    ViewBag.PageTitle = "مدیریت انتقادات و پیشنهادات";
}

<div class="row">
    <div class="col-md-4">
        <div class="card-box taskboard-box " style="padding: 15px;">
            @{
                if (Model.Correspondence.MessageAnswerId == null)
                {
                    <h4 class="header-title m-t-0 m-b-30 text-danger">برای پاسخ پیامی انتخاب نشده است</h4>
                }
                else
                {
                    <h4 class="header-title m-t-0 m-b-30 text-primary">پاسخ به پیام کاربر</h4>
                    <form asp-action="Save" method="post">
                        <div class="litelCardBox">
                            <h5 class="font-600 m-b-5">تاریخ ارسال:</h5>
                            <p>@DateTime.Now.ToPeString("dddd - dd MMMM - yyyy")</p>
                            <input type="hidden" asp-for="Correspondence.UserSenderId" value="@user.Id" />
                            <input type="hidden" asp-for="Correspondence.MessageAnswerId" />
                            <h5 class="font-600 m-b-5">متن پیام :</h5>
                            <p>@Model.Correspondence.OldTxt</p>
                            <h5 class="font-600 m-b-5">متن پاسخ :</h5>
                            <textarea asp-for="Correspondence.MessageText" class="form-control" rows="10"></textarea>
                            <div class="m-t-40">
                                <button type="submit" class="btn btn-primary waves-effect w-md waves-light m-b-5 ">ارسال پیام</button>
                                <a asp-action="Index" asp-controller="AdminCorrespondence" class="btn btn-danger waves-effect w-md waves-light m-b-5">پاک سازی</a>
                            </div>
                        </div>
                    </form>
                }
            }

        </div>
    </div><!-- end col -->


    <div class="col-md-8">
        <div class="card-box taskboard-box " style="padding: 10px;">
            <h4 class="header-title m-t-0 m-b-30 text-primary  ">پیام های ارسال شده</h4>

            <ul class="list-unstyled task-list litelCardBox" id="drag-upcoming">
                @{
                    foreach (var item in Model.CorrespondenceList)
                    {
                        if (item.MessageAnswerId == null)
                        {
                            <li class="p-20">
                                <div class="card-box downloadCardBox" style="min-height: 125px;height: 125px;">
                                    <div class="">
                                        <span class="label label-default pull-right correspondenceStyle"><b>تاریخ ارسال :</b>@item.InsertDate.ToPeString("yyyy/MM/dd")</span>
                                        <span class="label label-default pull-right correspondenceStyle">
                                            <b>
                                                کاربر :
                                            </b>@item.User.UserName @item.User.LastName
                                        </span>
                                           

                                            @{
                                                if (item.ViewState)
                                                {
                                                    <span class="label label-success   pull-right correspondenceStyle"><b>بازدید </b>شده</span>
                                                }
                                                else
                                                {
                                                    <span class="label label-danger    pull-right correspondenceStyle"><b>بازدید </b>نشده</span>
                                                    <a asp-action="changestate" asp-route-id="@item.Id" class="label label-info pull-right correspondenceStyle"><b>مشاهده شده</b></a>
                                                }
                                            }
                                            <a asp-action="GetById" asp-route-id="@item.Id" class="label label-info pull-right correspondenceStyle"><b>پاسخ</b></a>
                                            <a asp-action="Delete" asp-route-id="@item.Id" class="label label-danger pull-right correspondenceStyle"><b>حذف</b></a>
                                            <h5 class="font-600 m-b-5">پیام دریافت شده :</h5>
                                            <p style="word-wrap: break-word;">@item.MessageText </p>
                                            @{
                                                foreach (var inItem in Model.CorrespondenceList)
                                                {
                                                    if (inItem.MessageAnswerId == item.Id)
                                                    {
                                                        <h5 class="font-600 m-b-5">پاسخ ارسال شده :</h5>
                                                        <p style="word-wrap: break-word;">@inItem.MessageText</p>
                                                    }
                                                }
                                            }

</div>
                                </div>
                            </li>
                        }
                    }
                }
            </ul>

        </div>
    </div><!-- end col -->


</div>
<!-- End row -->

@section Scripts
    {
<script src="~/MyScript/AdminCorrespondence/AdminCorrespondence.js"></script>

}
